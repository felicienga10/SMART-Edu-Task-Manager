{% extends "base.html" %}

{% block content %}
<h2>Edit Task</h2>

<form method="POST" enctype="multipart/form-data">
    <div class="form-group">
        {{ form.hidden_tag() }}
        
        <div class="row">
            <div class="col-md-8">
                <label for="title">Task Title</label>
                {{ form.title(class="form-control", id="title") }}
                {% for error in form.title.errors %}
                    <span class="text-danger">{{ error }}</span>
                {% endfor %}
            </div>
        </div>

        <div class="form-group mt-3">
            <label for="description">Task Description</label>
            {{ form.description(class="form-control", id="description", rows="4") }}
            {% for error in form.description.errors %}
                <span class="text-danger">{{ error }}</span>
            {% endfor %}
            {% if suggested_priority %}
                <div class="alert alert-info mt-2">
                    <strong>Suggested Priority:</strong> {{ suggested_priority.replace('_', ' ').title() }}
                </div>
            {% endif %}
        </div>

        <div class="row mt-3">
            <div class="col-md-6">
                <label for="deadline">Deadline</label>
                {{ form.deadline(class="form-control", id="deadline") }}
                {% for error in form.deadline.errors %}
                    <span class="text-danger">{{ error }}</span>
                {% endfor %}
            </div>
            <div class="col-md-6">
                <label for="priority">Priority</label>
                {{ form.priority(class="form-control", id="priority") }}
                {% for error in form.priority.errors %}
                    <span class="text-danger">{{ error }}</span>
                {% endfor %}
            </div>
        </div>

        <div class="form-group mt-3">
            <label for="instructions">Additional Instructions</label>
            {{ form.instructions(class="form-control", id="instructions", rows="3") }}
            {% for error in form.instructions.errors %}
                <span class="text-danger">{{ error }}</span>
            {% endfor %}
        </div>

        <div class="form-group mt-3">
            <label for="task_file">Upload New File (Optional - Leave empty to keep current file)</label>
            {{ form.task_file(class="form-control-file", id="task_file") }}
            {% for error in form.task_file.errors %}
                <span class="text-danger">{{ error }}</span>
            {% endfor %}
            
            {% if task.file_path %}
            <div class="mt-2">
                <strong>Current File:</strong>
                <a href="{{ url_for('teacher.download_task_file', task_id=task.id) }}" class="btn btn-sm btn-info">
                    <i class="fas fa-download"></i> Download Current File
                </a>
            </div>
            {% endif %}
        </div>

        <div class="form-group mt-3">
            <label for="assigned_classes">Assign to Classes</label>
            {{ form.assigned_classes(class="form-select", id="assigned_classes", multiple=True, size="5") }}
            {% for error in form.assigned_classes.errors %}
                <span class="text-danger">{{ error }}</span>
            {% endfor %}
            <small class="form-text text-muted">
                <i class="fas fa-info-circle"></i> <strong>Multi-Select:</strong> Hold Ctrl (or Cmd) to select multiple classes.
                All students in the selected classes will be assigned this task.
                <br><strong>Note:</strong> Selecting classes here will replace all current assignments.
            </small>
        </div>

        <div class="form-group mt-4">
            {{ form.submit(class="btn btn-primary") }}
            <a href="{{ url_for('teacher.dashboard') }}" class="btn btn-secondary">Cancel</a>
        </div>
    </div>
</form>

<div class="card mt-4">
    <div class="card-header">
        <h5>Current Task Details</h5>
    </div>
    <div class="card-body">
        <p><strong>Created:</strong> {{ task.created_at.strftime('%Y-%m-%d %H:%M') }}</p>
        <p><strong>Created By:</strong> {{ task.creator.name }}</p>
        <p><strong>Current Assignments:</strong> {{ task.assignments|length }} student(s)</p>
        {% if task.file_path %}
        <p><strong>File Status:</strong> <span class="badge badge-success">Attached</span></p>
        {% endif %}
    </div>
</div>
{% endblock %}