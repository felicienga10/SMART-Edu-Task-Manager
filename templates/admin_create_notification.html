{% extends "base.html" %}

{% block content %}
<div class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-3 pb-2 mb-3 border-bottom">
    <h1 class="h2">Send System Notification</h1>
    <div class="btn-toolbar mb-2 mb-md-0">
        <a href="{{ url_for('admin.dashboard') }}" class="btn btn-secondary">
            <i class="bi bi-arrow-left"></i> Back to Dashboard
        </a>
    </div>
</div>

<div class="row justify-content-center">
    <div class="col-md-8">
        <div class="card">
            <div class="card-header">
                <h5 class="mb-0">Notification Details</h5>
            </div>
            <div class="card-body">
                <form method="POST">
                    <div class="mb-3">
                        <label for="title" class="form-label">Title</label>
                        <input type="text" class="form-control" id="title" name="title" required maxlength="200">
                        <div class="form-text">Brief title for the notification (max 200 characters)</div>
                    </div>

                    <div class="mb-3">
                        <label for="message" class="form-label">Message</label>
                        <textarea class="form-control" id="message" name="message" rows="4" required maxlength="1000"></textarea>
                        <div class="form-text">Detailed message for the notification (max 1000 characters)</div>
                    </div>

                    <div class="mb-3">
                        <label for="notification_type" class="form-label">Notification Type</label>
                        <select class="form-select" id="notification_type" name="notification_type">
                            <option value="info">Info (Blue)</option>
                            <option value="success">Success (Green)</option>
                            <option value="warning">Warning (Yellow)</option>
                            <option value="error">Error (Red)</option>
                        </select>
                    </div>

                    <div class="mb-3">
                        <label for="target_users" class="form-label">Send To</label>
                        <select class="form-select" id="target_users" name="target_users">
                            <option value="all">All Users</option>
                            <option value="teachers">Teachers Only</option>
                            <option value="students">Students Only</option>
                        </select>
                        <div class="form-text">Choose who should receive this notification</div>
                    </div>

                    <div class="d-grid gap-2">
                        <button type="submit" class="btn btn-primary">
                            <i class="bi bi-send"></i> Send Notification
                        </button>
                        <a href="{{ url_for('admin.dashboard') }}" class="btn btn-secondary">Cancel</a>
                    </div>
                </form>
            </div>
        </div>

        <!-- Preview Section -->
        <div class="card mt-3">
            <div class="card-header">
                <h5 class="mb-0">Preview</h5>
            </div>
            <div class="card-body">
                <div class="alert alert-info" id="preview-notification">
                    <strong id="preview-title">Notification Title</strong>
                    <div id="preview-message">This is how the notification will appear to users.</div>
                    <small class="text-muted">Type: <span id="preview-type">Info</span> | Target: <span id="preview-target">All Users</span></small>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
    const titleInput = document.getElementById('title');
    const messageInput = document.getElementById('message');
    const typeSelect = document.getElementById('notification_type');
    const targetSelect = document.getElementById('target_users');
    
    const previewTitle = document.getElementById('preview-title');
    const previewMessage = document.getElementById('preview-message');
    const previewType = document.getElementById('preview-type');
    const previewTarget = document.getElementById('preview-target');
    const previewNotification = document.getElementById('preview-notification');

    function updatePreview() {
        previewTitle.textContent = titleInput.value || 'Notification Title';
        previewMessage.textContent = messageInput.value || 'This is how the notification will appear to users.';
        
        const typeColors = {
            'info': 'alert-info',
            'success': 'alert-success',
            'warning': 'alert-warning',
            'error': 'alert-danger'
        };
        
        const typeNames = {
            'info': 'Info',
            'success': 'Success',
            'warning': 'Warning',
            'error': 'Error'
        };
        
        const targetNames = {
            'all': 'All Users',
            'teachers': 'Teachers Only',
            'students': 'Students Only'
        };
        
        // Reset classes
        previewNotification.className = 'alert ' + typeColors[typeSelect.value];
        
        previewType.textContent = typeNames[typeSelect.value];
        previewTarget.textContent = targetNames[targetSelect.value];
    }

    titleInput.addEventListener('input', updatePreview);
    messageInput.addEventListener('input', updatePreview);
    typeSelect.addEventListener('change', updatePreview);
    targetSelect.addEventListener('change', updatePreview);
    
    updatePreview(); // Initial call
});
</script>
{% endblock %}